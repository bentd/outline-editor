{"ast":null,"code":"import _toConsumableArray from \"/Users/bentd/Work/Notes/bullet-editor0/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport $ from \"jquery\";\nvar UPDATE_ROOT = \"UPDATE_ROOT\";\nvar ADD_BULLET = \"ADD_BULLET\";\nvar EDIT_BULLET = \"EDIT_BULLET\";\nvar DELETE_BULLET = \"DELETE_BULLET\";\nvar INDENT_BULLET = \"INDENT_BULLET\";\nvar UNINDENT_BULLET = \"UNINDENT_BULLET\";\nvar MOVE_BULLET = \"MOVE_BULLET\";\nvar EDIT_BULLET_NOTE = \"EDIT_BULLET_NOTE\";\nvar GO_DOWN = \"GO_DOWN\";\nvar GO_UP = \"GO_UP\";\n\nfunction updateRoot(root) {\n  return {\n    type: UPDATE_ROOT,\n    root: root,\n    exec: function exec(state) {\n      state.root = root;\n      return state;\n    }\n  };\n}\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position: position,\n    uuid: uuid,\n    exec: function exec(state) {\n      var childPosition = last(position);\n      var parent = getNode(ancestors(position), state.root);\n      parent.children.splice(childPosition + 1, 0, {\n        content: \"\",\n        note: \"\",\n        id: uuid,\n        completed: false,\n        children: []\n      });\n      focusNode({\n        id: uuid\n      });\n      return state;\n    }\n  };\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position, state.root);\n      node.content = content;\n      focusNode(node);\n      return state;\n    }\n  };\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (ancestors(position).length === 1 && last(position) === 0) {\n        return state;\n      }\n\n      var parent = getNode(ancestors(position), state.root);\n      var node = parent.children.splice(last(position), 1)[0];\n\n      if (node.children.length > 0) {\n        return state;\n      }\n\n      if (last(position) > 0) {\n        var _siblingAbove = parent.children.slice(last(position) - 1)[0];\n        focusNode(_siblingAbove);\n      } else {\n        focusNode(parent);\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (last(position) === 0) {\n        return state;\n      }\n\n      var tree = getTree(ancestors(position), state.root);\n      var oldParent = last(tree);\n      var newParent = getNode([].concat(_toConsumableArray(ancestors(position)), [last(position) - 1]), state.root);\n      var child = oldParent.children.splice(last(position), 1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      uncollapseTree(tree);\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (position.length < 3) {\n        return state;\n      }\n\n      var parent = getNode(ancestors(position), state.root);\n      var child = parent.children.splice(last(position), 1)[0];\n      var newParent = getNode(ancestors(ancestors(position)), state.root);\n      newParent.children.splice(last(ancestors(position)) + 1, 0, child);\n      console.log(\"newParent\", newParent);\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction editBulletNote(position, content) {\n  return {\n    type: EDIT_BULLET_NOTE,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position, state.root);\n      node.note = content;\n      console.log(state);\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newParentPosition: newParentPosition,\n    exec: function exec(state) {\n      var newParent = getNode(newParentPosition.slice(), state.root);\n      var oldParent = getNode(ancestors(childPosition), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n\n      if (childPosition.length === newParentPosition.length && last(newParentPosition) > last(childPosition)) {\n        uncollapseTree(getTree([].concat(_toConsumableArray(ancestors(newParentPosition)), [last(newParentPosition) - 1]), state.root));\n        return state;\n      }\n\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newSiblingPosition: newSiblingPosition,\n    exec: function exec(state) {\n      var newParent = getNode(ancestors(newSiblingPosition), state.root);\n      var oldParent = getNode(ancestors(childPosition), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.splice(last(newSiblingPosition), 0, child);\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position: position,\n    exec: function exec(state) {\n      var node = getNode(position.slice(), state.root);\n      var parent = getNode(ancestors(position), state.root);\n\n      if (position.length === 2 && last(position) === parent.children.length - 1) {\n        return state;\n      }\n\n      if (hasChildren(node) && !isCollapsed(node)) {\n        var childBelow = getNode([].concat(_toConsumableArray(position), [0]), state.root);\n        focusNode(childBelow);\n        return state;\n      }\n\n      var _position = position.slice();\n\n      while (_position.length !== 1) {\n        var _parent = getNode(ancestors(_position), state.root);\n\n        var _node = _position.pop();\n\n        if (_node < _parent.children.length - 1) {\n          focusNode(getNode(siblingBelow([].concat(_toConsumableArray(_position), [_node])), state.root));\n          return state;\n        }\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position: position,\n    exec: function exec(state) {\n      var parent = getNode(ancestors(position), state.root);\n\n      if (last(position) > 0) {\n        focusNode(getNode(siblingAbove(position), state.root));\n      } else {\n        console.log(\"focusing on parent\", parent);\n        focusNode(parent);\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction getNode(indices, root) {\n  var node = root[indices.shift()];\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n\n  return node;\n}\n\nfunction getTree(indices, root) {\n  var tree = [];\n  var node = root[indices.shift()];\n  tree.push(node);\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n\n  if (typeof window.getSelection != \"undefined\" && typeof document.createRange != \"undefined\") {\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    range.collapse(false);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n    var textRange = document.body.createTextRange();\n    textRange.moveToElementText(el);\n    textRange.collapse(false);\n    textRange.select();\n  }\n}\n\nfunction focusNode(node) {\n  var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).find(\".bullet-content\").focus();\n    placeCaretAtEnd($(\"#\".concat(node.id)).find(\".bullet-content\").get(0));\n  }, timeout);\n}\n\nfunction focusNodeNote(node) {\n  var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).find(\".bullet-note\").focus();\n    placeCaretAtEnd($(\"#\".concat(node.id)).find(\".bullet-note\").get(0));\n  }, timeout);\n}\n\nfunction isCollapsed(node) {\n  return $(\"#\".concat(node.id)).find(\".children\").attr(\"class\").indexOf(\"show\") !== -1;\n}\n\nfunction hasChildren(node) {\n  return node.children.length > 0;\n}\n\nfunction isLastChild(position, parent) {\n  return last(position) === parent.children.length - 1;\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(function () {\n    tree.map(function (node) {\n      $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n    });\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction siblingAbove(array) {\n  return [].concat(_toConsumableArray(ancestors(array)), [last(array) - 1]);\n}\n\nfunction siblingBelow(array) {\n  return [].concat(_toConsumableArray(ancestors(array)), [last(array) + 1]);\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\nexport { UPDATE_ROOT, ADD_BULLET, EDIT_BULLET, DELETE_BULLET, INDENT_BULLET, UNINDENT_BULLET, EDIT_BULLET_NOTE, MOVE_BULLET, GO_DOWN, GO_UP, updateRoot, addBullet, editBullet, deleteBullet, indentBullet, unindentBullet, editBulletNote, moveBulletAsChild, moveBulletAsSibling, getNode, getTree, goUp, goDown, focusNode, focusNodeNote, uncollapseNode, uncollapseTree };","map":{"version":3,"sources":["/Users/bentd/Work/Notes/bullet-editor0/src/Actions.js"],"names":["$","UPDATE_ROOT","ADD_BULLET","EDIT_BULLET","DELETE_BULLET","INDENT_BULLET","UNINDENT_BULLET","MOVE_BULLET","EDIT_BULLET_NOTE","GO_DOWN","GO_UP","updateRoot","root","type","exec","state","addBullet","position","uuid","childPosition","last","parent","getNode","ancestors","children","splice","content","note","id","completed","focusNode","editBullet","node","deleteBullet","length","siblingAbove","slice","indentBullet","tree","getTree","oldParent","newParent","child","push","uncollapseTree","unindentBullet","console","log","editBulletNote","moveBulletAsChild","newParentPosition","moveBulletAsSibling","newSiblingPosition","goDown","hasChildren","isCollapsed","childBelow","_position","pop","siblingBelow","goUp","indices","shift","placeCaretAtEnd","el","focus","window","getSelection","document","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","select","timeout","setTimeout","find","get","focusNodeNote","attr","indexOf","isLastChild","uncollapseNode","addClass","map","array"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\n\nconst UPDATE_ROOT = \"UPDATE_ROOT\";\nconst ADD_BULLET = \"ADD_BULLET\";\nconst EDIT_BULLET = \"EDIT_BULLET\";\nconst DELETE_BULLET = \"DELETE_BULLET\";\nconst INDENT_BULLET = \"INDENT_BULLET\";\nconst UNINDENT_BULLET = \"UNINDENT_BULLET\";\nconst MOVE_BULLET = \"MOVE_BULLET\";\nconst EDIT_BULLET_NOTE = \"EDIT_BULLET_NOTE\";\nconst GO_DOWN = \"GO_DOWN\";\nconst GO_UP = \"GO_UP\";\n\nfunction updateRoot(root) {\n  return {\n    type: UPDATE_ROOT,\n    root,\n    exec: (state) => {\n      state.root = root;\n      return state;\n    }\n  }\n}\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position,\n    uuid,\n    exec: (state) => {\n      let childPosition = last(position);\n      let parent = getNode(ancestors(position), state.root);\n      parent.children.splice(childPosition+1, 0, {content: \"\", note: \"\", id: uuid, completed: false, children: []});\n      focusNode({id: uuid});\n      return state;\n    }\n  }\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position, state.root);\n      node.content = content;\n      focusNode(node);\n      return state;\n    }\n  }\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position,\n    exec: (state) => {\n      if (ancestors(position).length === 1 && last(position) === 0) {\n        return state;\n      }\n      let parent = getNode(ancestors(position), state.root);\n      let node = parent.children.splice(last(position), 1)[0];\n      if (node.children.length > 0) { return state }\n      if (last(position) > 0) {\n        let siblingAbove = parent.children.slice(last(position)-1)[0];\n        focusNode(siblingAbove);\n      }\n      else {\n        focusNode(parent);\n      }\n      return state;\n    }\n  }\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (last(position) === 0) { return state }\n      let tree = getTree(ancestors(position), state.root);\n      let oldParent = last(tree);\n      let newParent = getNode([...ancestors(position), (last(position)-1)], state.root);\n      let child = oldParent.children.splice(last(position),1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      uncollapseTree(tree);\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (position.length < 3) { return state }\n      let parent = getNode(ancestors(position), state.root);\n      let child = parent.children.splice(last(position), 1)[0];\n      let newParent = getNode(ancestors(ancestors(position)), state.root);\n      newParent.children.splice(last(ancestors(position))+1, 0, child);\n      console.log(\"newParent\", newParent);\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction editBulletNote(position, content) {\n  return {\n    type: EDIT_BULLET_NOTE,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position, state.root);\n      node.note = content;\n      console.log(state);\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newParentPosition,\n    exec: (state) => {\n\n      let newParent = getNode(newParentPosition.slice(), state.root);\n      let oldParent = getNode(ancestors(childPosition), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n      if ((childPosition.length === newParentPosition.length) &&\n          (last(newParentPosition) > last(childPosition))) {\n        uncollapseTree(getTree([...ancestors(newParentPosition), last(newParentPosition)-1], state.root));\n        return state;\n      }\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newSiblingPosition,\n    exec: (state) => {\n      let newParent = getNode(ancestors(newSiblingPosition), state.root);\n      let oldParent = getNode(ancestors(childPosition), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.splice(last(newSiblingPosition), 0, child);\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position,\n    exec: (state) => {\n      let node = getNode(position.slice(), state.root);\n      let parent = getNode(ancestors(position), state.root);\n      if ((position.length === 2) && (last(position) === parent.children.length-1)) {\n        return state;\n      }\n      if ((hasChildren(node)) && !isCollapsed(node)) {\n        let childBelow = getNode([...position, 0], state.root);\n        focusNode(childBelow);\n        return state;\n      }\n      let _position = position.slice();\n      while(_position.length !== 1) {\n        let parent = getNode(ancestors(_position), state.root);\n        let node = _position.pop();\n        if (node < parent.children.length-1 ) {\n          focusNode(getNode(siblingBelow([..._position, node]), state.root));\n          return state;\n        }\n      }\n      return state;\n    }\n  }\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position,\n    exec: (state) => {\n      let parent = getNode(ancestors(position), state.root);\n      if (last(position) > 0) {\n        focusNode(getNode(siblingAbove(position), state.root));\n      }\n      else {\n        console.log(\"focusing on parent\", parent);\n        focusNode(parent);\n      }\n      return state;\n    }\n  }\n}\n\nfunction getNode(indices, root) {\n  let node = root[indices.shift()];\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n  return node;\n}\n\nfunction getTree(indices, root) {\n  let tree = [];\n  let node = root[indices.shift()];\n  tree.push(node)\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n  if (typeof window.getSelection != \"undefined\"\n          && typeof document.createRange != \"undefined\") {\n      var range = document.createRange();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      var sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n      var textRange = document.body.createTextRange();\n      textRange.moveToElementText(el);\n      textRange.collapse(false);\n      textRange.select();\n  }\n}\n\nfunction focusNode(node, timeout=0) {\n  setTimeout(() => {\n    $(`#${node.id}`).find(\".bullet-content\").focus();\n    placeCaretAtEnd($(`#${node.id}`).find(\".bullet-content\").get(0));\n  }, timeout);\n}\n\nfunction focusNodeNote(node, timeout=0) {\n  setTimeout(() => {\n    $(`#${node.id}`).find(\".bullet-note\").focus();\n    placeCaretAtEnd($(`#${node.id}`).find(\".bullet-note\").get(0));\n  }, timeout);\n}\n\nfunction isCollapsed(node) {\n  return ($(`#${node.id}`).find(\".children\").attr(\"class\").indexOf(\"show\")  !== -1);\n}\n\nfunction hasChildren(node) {\n  return (node.children.length > 0);\n}\n\nfunction isLastChild(position, parent) {\n  return (last(position) === (parent.children.length - 1));\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(() => {\n    $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(() => {\n    tree.map(node => {\n      $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n    });\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction siblingAbove(array) {\n  return [...ancestors(array), last(array)-1];\n}\n\nfunction siblingBelow(array) {\n  return [...ancestors(array), last(array)+1];\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\n\n\nexport { UPDATE_ROOT,\n         ADD_BULLET,\n         EDIT_BULLET,\n         DELETE_BULLET,\n         INDENT_BULLET,\n         UNINDENT_BULLET,\n         EDIT_BULLET_NOTE,\n         MOVE_BULLET,\n         GO_DOWN,\n         GO_UP,\n         updateRoot,\n         addBullet,\n         editBullet,\n         deleteBullet,\n         indentBullet,\n         unindentBullet,\n         editBulletNote,\n         moveBulletAsChild,\n         moveBulletAsSibling,\n         getNode,\n         getTree,\n         goUp,\n         goDown,\n         focusNode,\n         focusNodeNote,\n         uncollapseNode,\n         uncollapseTree };\n"]},"metadata":{},"sourceType":"module"}