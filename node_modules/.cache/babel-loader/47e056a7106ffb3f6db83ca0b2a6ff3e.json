{"ast":null,"code":"import _toConsumableArray from \"/Users/bentd/Work/Notes/bullet-editor0/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport $ from \"jquery\";\nimport uuidv1 from \"uuid/v1\";\nvar UPDATE_ACTIVE = \"UPDATE_ACTIVE\";\nvar UPDATE_ROOT = \"UPDATE_ROOT\";\nvar ADD_BULLET = \"ADD_BULLET\";\nvar EDIT_BULLET = \"EDIT_BULLET\";\nvar DELETE_BULLET = \"DELETE_BULLET\";\nvar INDENT_BULLET = \"INDENT_BULLET\";\nvar UNINDENT_BULLET = \"UNINDENT_BULLET\";\nvar MOVE_BULLET = \"MOVE_BULLET\";\nvar EDIT_BULLET_NOTE = \"EDIT_BULLET_NOTE\";\nvar GO_DOWN = \"GO_DOWN\";\nvar GO_UP = \"GO_UP\";\nvar TOGGLE_COLLAPSE = \"TOGGLE_COLLAPSE\";\n\nfunction updateActive(position) {\n  return {\n    type: UPDATE_ACTIVE,\n    exec: function exec(state) {\n      state.active = position;\n      return state;\n    }\n  };\n}\n\nfunction updateRoot(root) {\n  return {\n    type: UPDATE_ROOT,\n    root: root,\n    exec: function exec(state) {\n      state.root = root;\n      return state;\n    }\n  };\n}\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position: position,\n    uuid: uuid,\n    exec: function exec(state) {\n      var childPosition = last(position);\n      var parent = getNode(ancestors(position), state.root);\n      parent.children.splice(childPosition + 1, 0, {\n        content: \"\",\n        note: \"\",\n        id: uuid,\n        collapsed: true,\n        completed: false,\n        children: []\n      });\n      focusNode({\n        id: uuid\n      });\n      return state;\n    }\n  };\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position.slice(), state.root);\n      node.content = content;\n      focusNode(node);\n      return state;\n    }\n  };\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (ancestors(position).length === 1 && last(position) === 0) {\n        return state;\n      }\n\n      var parent = getNode(ancestors(position), state.root);\n      var node = parent.children.splice(last(position), 1)[0];\n\n      if (node.children.length > 0) {\n        return state;\n      }\n\n      if (last(position) > 0) {\n        var _siblingAbove = parent.children.slice(last(position) - 1)[0];\n        focusNode(_siblingAbove);\n        return state;\n      } else {\n        if (state.active.length > 0) {\n          return state;\n        } else {\n          focusNode(parent);\n          return state;\n        }\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (last(position) === 0) {\n        return state;\n      }\n\n      var tree = getTree(ancestors(position), state.root);\n      var oldParent = last(tree);\n      var newParent = getNode([].concat(_toConsumableArray(ancestors(position)), [last(position) - 1]), state.root);\n      var child = oldParent.children.splice(last(position), 1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      uncollapseTree(tree);\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (position.length < 3) {\n        return state;\n      }\n\n      var parent = getNode(ancestors(position), state.root);\n      var child = parent.children.splice(last(position), 1)[0];\n      var newParent = getNode(ancestors(ancestors(position)), state.root);\n      newParent.children.splice(last(ancestors(position)) + 1, 0, child);\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction editBulletNote(position, content) {\n  return {\n    type: EDIT_BULLET_NOTE,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position.slice(), state.root);\n      node.note = content;\n      focusNodeNote(node);\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newParentPosition: newParentPosition,\n    exec: function exec(state) {\n      var newParent = getNode(newParentPosition.slice(), state.root);\n      var oldParent = getNode(ancestors(childPosition), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n\n      if (childPosition.length === newParentPosition.length && last(newParentPosition) > last(childPosition)) {\n        uncollapseTree(getTree([].concat(_toConsumableArray(ancestors(newParentPosition)), [last(newParentPosition) - 1]), state.root));\n        return state;\n      }\n\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition, above) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newSiblingPosition: newSiblingPosition,\n    above: above,\n    exec: function exec(state) {\n      var newParent = getNode(ancestors(newSiblingPosition), state.root);\n      var oldParent = getNode(ancestors(childPosition), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n\n      if (above) {\n        newParent.children.splice(last(newSiblingPosition), 0, child);\n      } else {\n        newParent.children.splice(last(newSiblingPosition) + 1, 0, child);\n      }\n\n      focusNode(child);\n      return state;\n    }\n  };\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position: position,\n    exec: function exec(state) {\n      var node = getNode(position.slice(), state.root);\n      var parent = getNode(ancestors(position), state.root);\n\n      if (!isCollapsed(node)) {\n        var _childBelow = getNode(childBelow(position), state.root);\n\n        focusNode(_childBelow);\n        return state;\n      }\n\n      if (!isLastChild(position, parent)) {\n        var _siblingBelow = getNode(siblingBelow(position), state.root);\n\n        focusNode(_siblingBelow);\n        return state;\n      } else {\n        if (isRootChild(position)) {\n          return state;\n        } else {\n          var _position = position.slice();\n\n          while (_position.length !== 1) {\n            if (!isLastChild(_position, parent)) {\n              focusNode(getNode(siblingBelow(_position), state.root));\n              return state;\n            }\n\n            _position.pop();\n\n            parent = getNode(ancestors(_position), state.root);\n          }\n        }\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position: position,\n    exec: function exec(state) {\n      if (isFirstChild(position)) {\n        if (!isRootChild(position)) {\n          focusNode(getNode(ancestors(position), state.root));\n          return state;\n        } else {\n          return state;\n        }\n      }\n\n      if (!isFirstChild(position)) {\n        var nodeAbove = [].concat(_toConsumableArray(ancestors(position)), [last(position) - 1]);\n\n        var _siblingAbove2 = getNode(nodeAbove, state.root);\n\n        while (!isCollapsed(_siblingAbove2)) {\n          _siblingAbove2 = _siblingAbove2.children[_siblingAbove2.children.length - 1];\n        }\n\n        focusNode(_siblingAbove2);\n        return state;\n      }\n    }\n  };\n}\n\nfunction toggleCollapse(position) {\n  return {\n    type: TOGGLE_COLLAPSE,\n    exec: function exec(state) {\n      var node = getNode(position.slice(), state.root);\n      node.collapsed = !node.collapsed;\n\n      if (node.collapsed) {\n        collapseNode(node);\n      } else {\n        uncollapseNode(node);\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction getNode(indices, root) {\n  var node = root[indices.shift()];\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n\n  return node;\n}\n\nfunction getTree(indices, root) {\n  var tree = [];\n  var node = root[indices.shift()];\n  tree.push(node);\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n\n  if (typeof window.getSelection != \"undefined\" && typeof document.createRange != \"undefined\") {\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    range.collapse(false);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n    var textRange = document.body.createTextRange();\n    textRange.moveToElementText(el);\n    textRange.collapse(false);\n    textRange.select();\n  }\n}\n\nfunction focusNode(node) {\n  var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).find(\".content\").focus();\n    placeCaretAtEnd($(\"#\".concat(node.id)).find(\".content\").get(0));\n  }, timeout);\n}\n\nfunction focusNodeNote(node) {\n  var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).find(\".note\").focus();\n    placeCaretAtEnd($(\"#\".concat(node.id)).find(\".note\").get(0));\n  }, timeout);\n}\n\nfunction isCollapsed(node) {\n  if (node.children.length === 0) {\n    return true;\n  }\n\n  return $(\"#\".concat(node.id)).find(\".children\").attr(\"class\").indexOf(\"show\") === -1;\n}\n\nfunction hasChildren(node) {\n  return node.children.length > 0;\n}\n\nfunction isFirstChild(position) {\n  return last(position) === 0;\n}\n\nfunction isLastChild(position, parent) {\n  return last(position) === parent.children.length - 1;\n}\n\nfunction isRootChild(position) {\n  return position.length === 2;\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction collapseNode(node) {\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).children(\".collapse\").removeClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(function () {\n    tree.map(function (node) {\n      $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n      return node;\n    });\n  }, 0);\n}\n\nfunction collapseTree(tree) {\n  setTimeout(function () {\n    tree.map(function (node) {\n      $(\"#\".concat(node.id)).children(\".collapse\").removeClass(\"show\");\n      return node;\n    });\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction siblingAbove(array) {\n  return [].concat(_toConsumableArray(ancestors(array)), [last(array) - 1]);\n}\n\nfunction siblingBelow(array) {\n  return [].concat(_toConsumableArray(ancestors(array)), [last(array) + 1]);\n}\n\nfunction childBelow(array) {\n  return [].concat(_toConsumableArray(array), [0]);\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\nfunction sameArray(array1, array2) {\n  if (!(array1 instanceof Array) || !(array2 instanceof Array)) {\n    return false;\n  }\n\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  for (var i = 0; i < array1.length; i++) {\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction fixTree(node) {\n  if (node.id === undefined) {\n    node.id = uuidv1();\n  }\n\n  if (node.content === undefined) {\n    node.content = \"\";\n  }\n\n  if (node.completed === undefined) {\n    node.completed = false;\n  }\n\n  if (node.children === undefined) {\n    node.children = [];\n  }\n\n  if (node.collapsed === undefined) {\n    node.collapsed = true;\n  }\n\n  if (node.children.length > 0) {\n    for (var i = 0; i < node.children.length; i++) {\n      fixTree(node.children[i]);\n    }\n  }\n}\n\nfunction createNode() {\n  return {\n    id: uuidv1(),\n    content: \"\",\n    note: \"\",\n    collapsed: true,\n    completed: false,\n    children: []\n  };\n}\n\nexport { UPDATE_ACTIVE, UPDATE_ROOT, ADD_BULLET, EDIT_BULLET, DELETE_BULLET, INDENT_BULLET, UNINDENT_BULLET, EDIT_BULLET_NOTE, MOVE_BULLET, GO_DOWN, GO_UP, TOGGLE_COLLAPSE, updateActive, updateRoot, addBullet, editBullet, deleteBullet, indentBullet, unindentBullet, editBulletNote, moveBulletAsChild, moveBulletAsSibling, toggleCollapse, getNode, getTree, goUp, goDown, focusNode, focusNodeNote, isFirstChild, isRootChild, isCollapsed, uncollapseNode, uncollapseTree, sameArray, fixTree, createNode };","map":{"version":3,"sources":["/Users/bentd/Work/Notes/bullet-editor0/src/Actions.js"],"names":["$","uuidv1","UPDATE_ACTIVE","UPDATE_ROOT","ADD_BULLET","EDIT_BULLET","DELETE_BULLET","INDENT_BULLET","UNINDENT_BULLET","MOVE_BULLET","EDIT_BULLET_NOTE","GO_DOWN","GO_UP","TOGGLE_COLLAPSE","updateActive","position","type","exec","state","active","updateRoot","root","addBullet","uuid","childPosition","last","parent","getNode","ancestors","children","splice","content","note","id","collapsed","completed","focusNode","editBullet","node","slice","deleteBullet","length","siblingAbove","indentBullet","tree","getTree","oldParent","newParent","child","push","uncollapseTree","unindentBullet","editBulletNote","focusNodeNote","moveBulletAsChild","newParentPosition","moveBulletAsSibling","newSiblingPosition","above","goDown","isCollapsed","_childBelow","childBelow","isLastChild","_siblingBelow","siblingBelow","isRootChild","_position","pop","goUp","isFirstChild","nodeAbove","toggleCollapse","collapseNode","uncollapseNode","indices","shift","placeCaretAtEnd","el","focus","window","getSelection","document","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","select","timeout","setTimeout","find","get","attr","indexOf","hasChildren","addClass","removeClass","map","collapseTree","array","sameArray","array1","array2","Array","i","fixTree","undefined","createNode"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\nimport uuidv1 from \"uuid/v1\";\n\nconst UPDATE_ACTIVE = \"UPDATE_ACTIVE\";\nconst UPDATE_ROOT = \"UPDATE_ROOT\";\nconst ADD_BULLET = \"ADD_BULLET\";\nconst EDIT_BULLET = \"EDIT_BULLET\";\nconst DELETE_BULLET = \"DELETE_BULLET\";\nconst INDENT_BULLET = \"INDENT_BULLET\";\nconst UNINDENT_BULLET = \"UNINDENT_BULLET\";\nconst MOVE_BULLET = \"MOVE_BULLET\";\nconst EDIT_BULLET_NOTE = \"EDIT_BULLET_NOTE\";\nconst GO_DOWN = \"GO_DOWN\";\nconst GO_UP = \"GO_UP\";\nconst TOGGLE_COLLAPSE = \"TOGGLE_COLLAPSE\";\n\n\nfunction updateActive(position) {\n  return {\n    type: UPDATE_ACTIVE,\n    exec: (state) => {\n      state.active = position;\n      return state;\n    }\n  }\n}\n\n\nfunction updateRoot(root) {\n  return {\n    type: UPDATE_ROOT,\n    root,\n    exec: (state) => {\n      state.root = root;\n      return state;\n    }\n  }\n}\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position,\n    uuid,\n    exec: (state) => {\n      let childPosition = last(position);\n      let parent = getNode(ancestors(position), state.root);\n      parent.children.splice(childPosition+1, 0, {content: \"\", note: \"\", id: uuid, collapsed: true, completed: false, children: []});\n      focusNode({id: uuid});\n      return state;\n    }\n  }\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position.slice(), state.root);\n      node.content = content;\n      focusNode(node);\n      return state;\n    }\n  }\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position,\n    exec: (state) => {\n      if (ancestors(position).length === 1 && last(position) === 0) {\n        return state;\n      }\n      let parent = getNode(ancestors(position), state.root);\n      let node = parent.children.splice(last(position), 1)[0];\n      if (node.children.length > 0) { return state }\n      if (last(position) > 0) {\n        let siblingAbove = parent.children.slice(last(position)-1)[0];\n        focusNode(siblingAbove);\n        return state;\n      }\n      else {\n        if (state.active.length > 0) {\n          return state;\n        }\n        else {\n          focusNode(parent);\n          return state;\n        }\n      }\n      return state;\n    }\n  }\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (last(position) === 0) { return state }\n      let tree = getTree(ancestors(position), state.root);\n      let oldParent = last(tree);\n      let newParent = getNode([...ancestors(position), (last(position)-1)], state.root);\n      let child = oldParent.children.splice(last(position),1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      uncollapseTree(tree);\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (position.length < 3) { return state }\n      let parent = getNode(ancestors(position), state.root);\n      let child = parent.children.splice(last(position), 1)[0];\n      let newParent = getNode(ancestors(ancestors(position)), state.root);\n      newParent.children.splice(last(ancestors(position))+1, 0, child);\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction editBulletNote(position, content) {\n  return {\n    type: EDIT_BULLET_NOTE,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position.slice(), state.root);\n      node.note = content;\n      focusNodeNote(node);\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newParentPosition,\n    exec: (state) => {\n      let newParent = getNode(newParentPosition.slice(), state.root);\n      let oldParent = getNode(ancestors(childPosition), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n      if ((childPosition.length === newParentPosition.length) &&\n          (last(newParentPosition) > last(childPosition))) {\n        uncollapseTree(getTree([...ancestors(newParentPosition), last(newParentPosition)-1], state.root));\n        return state;\n      }\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition, above) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newSiblingPosition,\n    above,\n    exec: (state) => {\n      let newParent = getNode(ancestors(newSiblingPosition), state.root);\n      let oldParent = getNode(ancestors(childPosition), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      if (above) {\n        newParent.children.splice(last(newSiblingPosition), 0, child);\n      }\n      else {\n        newParent.children.splice(last(newSiblingPosition)+1, 0, child);\n      }\n      focusNode(child);\n      return state;\n    }\n  }\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position,\n    exec: (state) => {\n      let node = getNode(position.slice(), state.root);\n      let parent = getNode(ancestors(position), state.root);\n\n      if (!isCollapsed(node)) {\n        let _childBelow = getNode(childBelow(position), state.root);\n        focusNode(_childBelow);\n        return state;\n      }\n\n      if(!isLastChild(position, parent)) {\n        let _siblingBelow = getNode(siblingBelow(position), state.root);\n        focusNode(_siblingBelow);\n        return state;\n      }\n\n      else {\n        if (isRootChild(position)) {\n          return state;\n        }\n        else {\n          let _position = position.slice();\n          while(_position.length !== 1) {\n            if (!isLastChild(_position, parent)) {\n              focusNode(getNode(siblingBelow(_position), state.root));\n              return state;\n            }\n            _position.pop();\n            parent = getNode(ancestors(_position), state.root);\n          }\n        }\n      }\n      return state;\n    }\n  }\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position,\n    exec: (state) => {\n      if (isFirstChild(position)) {\n        if (!isRootChild(position)) {\n          focusNode(getNode(ancestors(position), state.root));\n          return state;\n        }\n        else {\n          return state;\n        }\n      }\n      if (!isFirstChild(position)) {\n        let nodeAbove = [...ancestors(position), last(position)-1];\n        let siblingAbove = getNode(nodeAbove, state.root);\n        while (!isCollapsed(siblingAbove)) {\n          siblingAbove = siblingAbove.children[siblingAbove.children.length-1];\n        }\n        focusNode(siblingAbove);\n        return state;\n      }\n    }\n  }\n}\n\nfunction toggleCollapse(position) {\n  return {\n    type: TOGGLE_COLLAPSE,\n    exec: (state) => {\n      let node = getNode(position.slice(), state.root);\n      node.collapsed = !(node.collapsed);\n      if (node.collapsed) {\n        collapseNode(node);\n      }\n      else {\n        uncollapseNode(node);\n      }\n      return state;\n    }\n  }\n}\n\nfunction getNode(indices, root) {\n  let node = root[indices.shift()];\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n  return node;\n}\n\nfunction getTree(indices, root) {\n  let tree = [];\n  let node = root[indices.shift()];\n  tree.push(node)\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n  if (typeof window.getSelection != \"undefined\"\n          && typeof document.createRange != \"undefined\") {\n      var range = document.createRange();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      var sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n      var textRange = document.body.createTextRange();\n      textRange.moveToElementText(el);\n      textRange.collapse(false);\n      textRange.select();\n  }\n}\n\nfunction focusNode(node, timeout=0) {\n  setTimeout(() => {\n    $(`#${node.id}`).find(\".content\").focus();\n    placeCaretAtEnd($(`#${node.id}`).find(\".content\").get(0));\n  }, timeout);\n}\n\nfunction focusNodeNote(node, timeout=0) {\n  setTimeout(() => {\n    $(`#${node.id}`).find(\".note\").focus();\n    placeCaretAtEnd($(`#${node.id}`).find(\".note\").get(0));\n  }, timeout);\n}\n\nfunction isCollapsed(node) {\n  if (node.children.length === 0) {\n    return true;\n  }\n  return ($(`#${node.id}`).find(\".children\").attr(\"class\").indexOf(\"show\")  === -1);\n}\n\nfunction hasChildren(node) {\n  return (node.children.length > 0);\n}\n\nfunction isFirstChild(position) {\n  return (last(position) === 0);\n}\n\nfunction isLastChild(position, parent) {\n  return (last(position) === (parent.children.length - 1));\n}\n\nfunction isRootChild(position) {\n  return (position.length === 2);\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(() => {\n    $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction collapseNode(node) {\n  setTimeout(() => {\n    $(`#${node.id}`).children(\".collapse\").removeClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(() => {\n    tree.map(node => {\n      $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n      return node;\n    });\n  }, 0);\n}\n\nfunction collapseTree(tree) {\n  setTimeout(() => {\n    tree.map(node => {\n      $(`#${node.id}`).children(\".collapse\").removeClass(\"show\");\n      return node;\n    });\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction siblingAbove(array) {\n  return [...ancestors(array), last(array)-1];\n}\n\nfunction siblingBelow(array) {\n  return [...ancestors(array), last(array)+1];\n}\n\nfunction childBelow(array) {\n  return [...array, 0];\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\nfunction sameArray(array1, array2) {\n  if (!(array1 instanceof Array) || !(array2 instanceof Array)) {\n    return false;\n  }\n\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  for (var i = 0; i < array1.length; i++) {\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction fixTree(node) {\n  if (node.id === undefined) {\n    node.id = uuidv1();\n  }\n  if (node.content === undefined) {\n    node.content = \"\";\n  }\n  if (node.completed === undefined) {\n    node.completed = false;\n  }\n  if (node.children === undefined) {\n    node.children = [];\n  }\n  if (node.collapsed === undefined) {\n    node.collapsed = true;\n  }\n  if (node.children.length > 0) {\n    for (var i = 0; i < node.children.length; i++) {\n      fixTree(node.children[i]);\n    }\n  }\n}\n\nfunction createNode() {\n  return {\n    id: uuidv1(),\n    content: \"\",\n    note: \"\",\n    collapsed: true,\n    completed: false,\n    children: []\n  }\n}\n\nexport { UPDATE_ACTIVE,\n         UPDATE_ROOT,\n         ADD_BULLET,\n         EDIT_BULLET,\n         DELETE_BULLET,\n         INDENT_BULLET,\n         UNINDENT_BULLET,\n         EDIT_BULLET_NOTE,\n         MOVE_BULLET,\n         GO_DOWN,\n         GO_UP,\n         TOGGLE_COLLAPSE,\n         updateActive,\n         updateRoot,\n         addBullet,\n         editBullet,\n         deleteBullet,\n         indentBullet,\n         unindentBullet,\n         editBulletNote,\n         moveBulletAsChild,\n         moveBulletAsSibling,\n         toggleCollapse,\n         getNode,\n         getTree,\n         goUp,\n         goDown,\n         focusNode,\n         focusNodeNote,\n         isFirstChild,\n         isRootChild,\n         isCollapsed,\n         uncollapseNode,\n         uncollapseTree,\n         sameArray,\n         fixTree,\n         createNode };\n"]},"metadata":{},"sourceType":"module"}