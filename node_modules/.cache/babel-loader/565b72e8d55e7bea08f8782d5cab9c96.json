{"ast":null,"code":"import _toConsumableArray from \"/Users/bentd/Work/Notes/bullet-editor0/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport $ from \"jquery\";\nvar ADD_BULLET = \"ADD_BULLET\";\nvar EDIT_BULLET = \"EDIT_BULLET\";\nvar DELETE_BULLET = \"DELETE_BULLET\";\nvar INDENT_BULLET = \"INDENT_BULLET\";\nvar UNINDENT_BULLET = \"UNINDENT_BULLET\";\nvar MOVE_BULLET = \"MOVE_BULLET\";\nvar GO_DOWN = \"GO_DOWN\";\nvar GO_UP = \"GO_UP\";\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position: position,\n    uuid: uuid,\n    exec: function exec(state) {\n      var childPosition = last(position);\n      var parent = getNode(position.slice(0, -1), state.root);\n      parent.children.splice(childPosition + 1, 0, {\n        content: \"\",\n        note: \"\",\n        id: uuid,\n        completed: false,\n        children: []\n      });\n      focusNode({\n        id: uuid\n      });\n      return state;\n    }\n  };\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position, state.root);\n      node.content = content;\n      return state;\n    }\n  };\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position: position,\n    exec: function exec(state) {\n      var parent = getNode(position.slice(0, -1), state.root);\n      var node = parent.children.splice(last(position), 1)[0];\n\n      if (node.children.length > 0) {\n        return state;\n      }\n\n      if (last(position) > 0) {\n        var siblingAbove = parent.children.slice(last(position) - 1)[0];\n        var content = siblingAbove.content;\n        focusNode(siblingAbove);\n      } else {\n        setTimeout(function () {\n          placeCaretAtEnd($(\"#\".concat(parent.id)).find(\".bullet-content\").get(0));\n          $(\"#\".concat(parent.id)).find(\".bullet-content\").focus();\n        }, 0);\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (last(position) == 0) {\n        return state;\n      }\n\n      var childPosition = last(position);\n      var tree = getTree(position.slice(0, -1), state.root);\n      var newParent = getNode([].concat(_toConsumableArray(position.slice(0, -1)), [childPosition - 1]), state.root);\n      var oldParent = tree.slice(-1)[0];\n      var child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      setTimeout(function () {\n        tree.map(function (parent) {\n          $(\"#\".concat(parent.id)).children(\".collapse\").addClass(\"show\");\n          placeCaretAtEnd($(\"#\".concat(child.id)).find(\".bullet-content\").get(0));\n          $(\"#\".concat(child.id)).find(\".bullet-content\").focus();\n        });\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (position.length < 3) {\n        return state;\n      }\n\n      var childPosition = last(position);\n      var oldParentPosition = position.slice(-2)[0];\n      var tree = getTree(position.slice(0, -2), state.root);\n      var newParent = tree.slice(-1)[0];\n      var oldParent = getNode(position.slice(0, -1), state.root);\n      var child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.splice(oldParentPosition + 1, 0, child);\n      setTimeout(function () {\n        tree.slice(0, -2).map(function (parent) {\n          $(\"#\".concat(parent.id)).children(\".collapse\").addClass(\"show\");\n          placeCaretAtEnd($(\"#\".concat(child.id)).find(\".bullet-content\").get(0));\n          $(\"#\".concat(child.id)).find(\".bullet-content\").focus();\n        });\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newParentPosition: newParentPosition,\n    exec: function exec(state) {\n      var newParent = getNode(newParentPosition.slice(), state.root);\n      var oldParent = getNode(childPosition.slice(0, -1), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n\n      if (childPosition.length == newParentPosition.length && last(newParentPosition) > last(childPosition)) {\n        uncollapseTree(getTree([].concat(_toConsumableArray(ancestors(newParentPosition)), [last(newParentPosition) - 1]), state.root));\n        return state;\n      }\n\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      return state;\n    }\n  };\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newSiblingPosition: newSiblingPosition,\n    exec: function exec(state) {\n      var newParent = getNode(newSiblingPosition.slice(0, -1), state.root);\n      var oldParent = getNode(childPosition.slice(0, -1), state.root);\n      var child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.splice(last(newSiblingPosition) + 1, 0, child);\n      return state;\n    }\n  };\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position: position,\n    exec: function exec(state) {\n      var tree = getTree(position.slice(), state.root);\n\n      var _position = position.slice();\n\n      var childPosition = _position.pop();\n\n      var parent = getNode(_position.slice(), state.root);\n\n      while (childPosition == parent.children.length - 1) {\n        if (_position.length == 1) {\n          return state;\n        }\n\n        var _childPosition = _position.pop();\n\n        var _parent = getNode(last(_position).slice(), state.root);\n      }\n\n      focusNode(getNode([].concat(_toConsumableArray(_position), [childPosition + 1]), state.root));\n      return state;\n    }\n  };\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position: position,\n    exec: function exec(state) {\n      var tree = getTree(position.slice(), state.root);\n\n      var _position = position.slice();\n\n      var childPosition = _position.pop();\n\n      var parent = getNode(_position.slice(), state.root);\n\n      while (childPosition == 0) {\n        if (_position.length == 1) {\n          return state;\n        }\n\n        var _childPosition2 = _position.pop();\n\n        var _parent2 = getNode(last(_position).slice(), state.root);\n      }\n\n      focusNode(getNode([].concat(_toConsumableArray(_position), [childPosition - 1]), state.root));\n      return state;\n    }\n  };\n}\n\nfunction getNode(indices, root) {\n  var node = root[indices.shift()];\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n\n  return node;\n}\n\nfunction getTree(indices, root) {\n  var tree = [];\n  var node = root[indices.shift()];\n  tree.push(node);\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n\n  if (typeof window.getSelection != \"undefined\" && typeof document.createRange != \"undefined\") {\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    range.collapse(false);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n    var textRange = document.body.createTextRange();\n    textRange.moveToElementText(el);\n    textRange.collapse(false);\n    textRange.select();\n  }\n}\n\nfunction focusNode(node) {\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).find(\".bullet-content\").focus();\n    placeCaretAtEnd($(\"#\".concat(node.id)).find(\".bullet-content\").get(0));\n  }, 0);\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(function () {\n    $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(function () {\n    tree.map(function (node) {\n      $(\"#\".concat(node.id)).children(\".collapse\").addClass(\"show\");\n    });\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\nexport { ADD_BULLET, EDIT_BULLET, DELETE_BULLET, INDENT_BULLET, UNINDENT_BULLET, MOVE_BULLET, GO_DOWN, GO_UP, addBullet, editBullet, deleteBullet, indentBullet, unindentBullet, moveBulletAsChild, moveBulletAsSibling, getNode, getTree, goUp, goDown };","map":{"version":3,"sources":["/Users/bentd/Work/Notes/bullet-editor0/src/Actions.js"],"names":["$","ADD_BULLET","EDIT_BULLET","DELETE_BULLET","INDENT_BULLET","UNINDENT_BULLET","MOVE_BULLET","GO_DOWN","GO_UP","addBullet","position","uuid","type","exec","state","childPosition","last","parent","getNode","slice","root","children","splice","content","note","id","completed","focusNode","editBullet","node","deleteBullet","length","siblingAbove","setTimeout","placeCaretAtEnd","find","get","focus","indentBullet","tree","getTree","newParent","oldParent","child","push","map","addClass","unindentBullet","oldParentPosition","moveBulletAsChild","newParentPosition","uncollapseTree","ancestors","moveBulletAsSibling","newSiblingPosition","goDown","_position","pop","goUp","indices","shift","el","window","getSelection","document","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","select","uncollapseNode","array"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\n\nconst ADD_BULLET = \"ADD_BULLET\";\nconst EDIT_BULLET = \"EDIT_BULLET\";\nconst DELETE_BULLET = \"DELETE_BULLET\";\nconst INDENT_BULLET = \"INDENT_BULLET\";\nconst UNINDENT_BULLET = \"UNINDENT_BULLET\";\nconst MOVE_BULLET = \"MOVE_BULLET\";\nconst GO_DOWN = \"GO_DOWN\";\nconst GO_UP = \"GO_UP\";\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position,\n    uuid,\n    exec: (state) => {\n      let childPosition = last(position);\n      let parent = getNode(position.slice(0,-1), state.root);\n      parent.children.splice(childPosition+1, 0, {content: \"\", note: \"\", id: uuid, completed: false, children: []});\n      focusNode({id: uuid});\n      return state;\n    }\n  }\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position, state.root);\n      node.content = content;\n      return state;\n    }\n  }\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position,\n    exec: (state) => {\n      let parent = getNode(position.slice(0, -1), state.root);\n      let node = parent.children.splice(last(position), 1)[0];\n      if (node.children.length > 0) { return state }\n      if (last(position) > 0) {\n        let siblingAbove = parent.children.slice(last(position)-1)[0];\n        let content = siblingAbove.content;\n        focusNode(siblingAbove);\n      }\n      else {\n        setTimeout(() => {\n          placeCaretAtEnd($(`#${parent.id}`).find(\".bullet-content\").get(0));\n          $(`#${parent.id}`).find(\".bullet-content\").focus();\n        }, 0);\n      }\n      return state;\n    }\n  }\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (last(position) == 0) { return state }\n      let childPosition = last(position);\n      let tree = getTree(position.slice(0,-1), state.root);\n      let newParent = getNode([...position.slice(0,-1), (childPosition-1)], state.root);\n      let oldParent = tree.slice(-1)[0];\n      let child = oldParent.children.splice(childPosition,1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      setTimeout(() => {\n        tree.map(parent => {\n          $(`#${parent.id}`).children(\".collapse\").addClass(\"show\");\n          placeCaretAtEnd($(`#${child.id}`).find(\".bullet-content\").get(0));\n          $(`#${child.id}`).find(\".bullet-content\").focus();\n        });\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (position.length < 3) { return state }\n      let childPosition = last(position);\n      let oldParentPosition = position.slice(-2)[0];\n      let tree = getTree(position.slice(0, -2), state.root);\n      let newParent = tree.slice(-1)[0];\n      let oldParent = getNode(position.slice(0, -1), state.root);\n      let child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.splice((oldParentPosition + 1), 0, child);\n      setTimeout(() => {\n        tree.slice(0,-2).map(parent => {\n          $(`#${parent.id}`).children(\".collapse\").addClass(\"show\");\n          placeCaretAtEnd($(`#${child.id}`).find(\".bullet-content\").get(0));\n          $(`#${child.id}`).find(\".bullet-content\").focus();\n        });\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsChild(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newParentPosition,\n    exec: (state) => {\n      let newParent = getNode(newParentPosition.slice(), state.root);\n      let oldParent = getNode(childPosition.slice(0,-1), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.push(child);\n      if ((childPosition.length == newParentPosition.length) &&\n          (last(newParentPosition) > last(childPosition))) {\n        uncollapseTree(getTree([...ancestors(newParentPosition), last(newParentPosition)-1], state.root));\n        return state;\n      }\n      uncollapseTree(getTree(newParentPosition.slice(), state.root));\n      return state;\n    }\n  }\n}\n\nfunction moveBulletAsSibling(childPosition, newSiblingPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newSiblingPosition,\n    exec: (state) => {\n      let newParent = getNode(newSiblingPosition.slice(0, -1), state.root);\n      let oldParent = getNode(childPosition.slice(0,-1), state.root);\n      let child = oldParent.children.splice(last(childPosition), 1)[0];\n      newParent.children.splice(last(newSiblingPosition)+1, 0, child);\n      return state;\n    }\n  }\n}\n\nfunction goDown(position) {\n  return {\n    type: GO_DOWN,\n    position,\n    exec: (state) => {\n      let tree = getTree(position.slice(), state.root);\n      let _position = position.slice();\n      let childPosition = _position.pop();\n      let parent = getNode(_position.slice(), state.root);\n      while(childPosition == parent.children.length-1) {\n        if (_position.length == 1) { return state }\n        let childPosition = _position.pop();\n        let parent = getNode(last(_position).slice(), state.root);\n      }\n      focusNode(getNode([..._position, childPosition+1], state.root));\n      return state;\n    }\n  }\n}\n\nfunction goUp(position) {\n  return {\n    type: GO_UP,\n    position,\n    exec: (state) => {\n      let tree = getTree(position.slice(), state.root);\n      let _position = position.slice();\n      let childPosition = _position.pop();\n      let parent = getNode(_position.slice(), state.root);\n      while(childPosition == 0) {\n        if (_position.length == 1) { return state }\n        let childPosition = _position.pop();\n        let parent = getNode(last(_position).slice(), state.root);\n      }\n      focusNode(getNode([..._position, childPosition-1], state.root));\n      return state;\n    }\n  }\n}\n\nfunction getNode(indices, root) {\n  let node = root[indices.shift()];\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n  return node;\n}\n\nfunction getTree(indices, root) {\n  let tree = [];\n  let node = root[indices.shift()];\n  tree.push(node)\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n  if (typeof window.getSelection != \"undefined\"\n          && typeof document.createRange != \"undefined\") {\n      var range = document.createRange();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      var sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n      var textRange = document.body.createTextRange();\n      textRange.moveToElementText(el);\n      textRange.collapse(false);\n      textRange.select();\n  }\n}\n\nfunction focusNode(node) {\n  setTimeout(() => {\n    $(`#${node.id}`).find(\".bullet-content\").focus();\n    placeCaretAtEnd($(`#${node.id}`).find(\".bullet-content\").get(0));\n  }, 0);\n}\n\nfunction uncollapseNode(node) {\n  setTimeout(() => {\n    $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n  }, 0);\n}\n\nfunction uncollapseTree(tree) {\n  setTimeout(() => {\n    tree.map(node => {\n    $(`#${node.id}`).children(\".collapse\").addClass(\"show\");\n    })\n  }, 0);\n}\n\nfunction last(array) {\n  return array.slice(-1)[0];\n}\n\nfunction ancestors(array) {\n  return array.slice(0, -1);\n}\n\n\n\nexport { ADD_BULLET,\n         EDIT_BULLET,\n         DELETE_BULLET,\n         INDENT_BULLET,\n         UNINDENT_BULLET,\n         MOVE_BULLET,\n         GO_DOWN,\n         GO_UP,\n         addBullet,\n         editBullet,\n         deleteBullet,\n         indentBullet,\n         unindentBullet,\n         moveBulletAsChild,\n         moveBulletAsSibling,\n         getNode,\n         getTree,\n         goUp,\n         goDown };\n"]},"metadata":{},"sourceType":"module"}