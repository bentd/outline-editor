{"ast":null,"code":"import _toConsumableArray from \"/Users/bentd/Work/Notes/bullet-editor/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport $ from \"jquery\";\nvar ADD_BULLET = \"ADD_BULLET\";\nvar EDIT_BULLET = \"EDIT_BULLET\";\nvar DELETE_BULLET = \"DELETE_BULLET\";\nvar INDENT_BULLET = \"INDENT_BULLET\";\nvar UNINDENT_BULLET = \"UNINDENT_BULLET\";\nvar MOVE_BULLET = \"MOVE_BULLET\";\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position: position,\n    uuid: uuid,\n    exec: function exec(state) {\n      var childPosition = position.slice(-1)[0];\n      var parent = getNode(position.slice(0, -1), state.root);\n      parent.children.splice(childPosition + 1, 0, {\n        content: \"\",\n        note: \"\",\n        id: uuid,\n        completed: false,\n        children: []\n      });\n      setTimeout(function () {\n        $(\"#\".concat(uuid)).find(\".bullet-content\").focus();\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position: position,\n    content: content,\n    exec: function exec(state) {\n      var node = getNode(position, state.root);\n      node.content = content;\n      console.log(\"editBullet content\", content);\n      console.log(\"editBullet state\", state);\n      return state;\n    }\n  };\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position: position,\n    exec: function exec(state) {\n      var parent = getNode(position.slice(0, -1), state.root);\n      var node = parent.children.splice(position.slice(-1)[0], 1);\n\n      if (node.children.length > 0) {\n        return state;\n      }\n\n      if (position.slice(-1)[0] > 0) {\n        var sibling = parent.children.slice(position.slice(-1)[0] - 1)[0];\n        var content = sibling.content;\n        setTimeout(function () {\n          placeCaretAtEnd($(\"#\".concat(sibling.id)).find(\".bullet-content\").get(0));\n          $(\"#\".concat(sibling.id)).find(\".bullet-content\").focus();\n        }, 0);\n      }\n\n      return state;\n    }\n  };\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (position.slice(-1)[0] == 0) {\n        return state;\n      }\n\n      var childPosition = position.slice(-1)[0];\n      var tree = getTree(position.slice(0, -1), state.root);\n      var newParent = getNode([].concat(_toConsumableArray(position.slice(0, -1)), [childPosition - 1]), state.root);\n      var oldParent = tree.slice(-1)[0];\n      var child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      setTimeout(function () {\n        tree.map(function (parent) {\n          $(\"#\".concat(parent.id)).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position: position,\n    exec: function exec(state) {\n      if (position.length < 3) {\n        return state;\n      }\n\n      var childPosition = position.slice(-1)[0];\n      var oldParentPosition = position.slice(-2)[0];\n      var tree = getTree(position.slice(0, -2), state.root);\n      var newParent = tree.slice(-1)[0];\n      var oldParent = getNode(position.slice(0, -1), state.root);\n      var child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.splice(oldParentPosition + 1, 0, child);\n      setTimeout(function () {\n        tree.slice(0, -2).map(function (parent) {\n          $(\"#\".concat(parent.id)).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction moveBullet(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition: childPosition,\n    newParentPosition: newParentPosition,\n    exec: function exec(state) {\n      console.log(childPosition, newParentPosition);\n      var newParent = getNode(newParentPosition.slice(), state.root);\n      var oldParent = getNode(childPosition.slice(0, -1), state.root);\n      var child = oldParent.children.splice(childPosition.slice(-1)[0], 1)[0];\n      newParent.children.push(child);\n      setTimeout(function () {\n        getTree(newParentPosition.slice(), state.root).map(function (parent) {\n          $(\"#\".concat(parent.id)).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  };\n}\n\nfunction getNode(indices, root) {\n  var node = root[indices.shift()];\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n\n  return node;\n}\n\nfunction getTree(indices, root) {\n  var tree = [];\n  var node = root[indices.shift()];\n  tree.push(node);\n\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n\n  if (typeof window.getSelection != \"undefined\" && typeof document.createRange != \"undefined\") {\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    range.collapse(false);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n    var textRange = document.body.createTextRange();\n    textRange.moveToElementText(el);\n    textRange.collapse(false);\n    textRange.select();\n  }\n}\n\nexport { ADD_BULLET, EDIT_BULLET, DELETE_BULLET, INDENT_BULLET, UNINDENT_BULLET, MOVE_BULLET, addBullet, editBullet, deleteBullet, indentBullet, unindentBullet, moveBullet, getNode, getTree };","map":{"version":3,"sources":["/Users/bentd/Work/Notes/bullet-editor/src/Actions.js"],"names":["$","ADD_BULLET","EDIT_BULLET","DELETE_BULLET","INDENT_BULLET","UNINDENT_BULLET","MOVE_BULLET","addBullet","position","uuid","type","exec","state","childPosition","slice","parent","getNode","root","children","splice","content","note","id","completed","setTimeout","find","focus","editBullet","node","console","log","deleteBullet","length","sibling","placeCaretAtEnd","get","indentBullet","tree","getTree","newParent","oldParent","child","push","map","addClass","unindentBullet","oldParentPosition","moveBullet","newParentPosition","indices","shift","el","window","getSelection","document","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","select"],"mappings":"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","sourcesContent":["import $ from \"jquery\";\n\nconst ADD_BULLET = \"ADD_BULLET\";\nconst EDIT_BULLET = \"EDIT_BULLET\";\nconst DELETE_BULLET = \"DELETE_BULLET\";\nconst INDENT_BULLET = \"INDENT_BULLET\";\nconst UNINDENT_BULLET = \"UNINDENT_BULLET\";\nconst MOVE_BULLET = \"MOVE_BULLET\";\n\nfunction addBullet(position, uuid) {\n  return {\n    type: ADD_BULLET,\n    position,\n    uuid,\n    exec: (state) => {\n      let childPosition = position.slice(-1)[0];\n      let parent = getNode(position.slice(0,-1), state.root);\n      parent.children.splice(childPosition + 1, 0, {content: \"\", note: \"\", id: uuid, completed: false, children: []});\n      setTimeout(() => {\n        $(`#${uuid}`).find(\".bullet-content\").focus();\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction editBullet(position, content) {\n  return {\n    type: EDIT_BULLET,\n    position,\n    content,\n    exec: (state) => {\n      let node = getNode(position, state.root);\n      node.content = content;\n      console.log(\"editBullet content\", content);\n      console.log(\"editBullet state\", state);\n      return state;\n    }\n  }\n}\n\nfunction deleteBullet(position) {\n  return {\n    type: DELETE_BULLET,\n    position,\n    exec: (state) => {\n      let parent = getNode(position.slice(0, -1), state.root);\n      let node = parent.children.splice(position.slice(-1)[0], 1);\n      if (node.children.length > 0) { return state }\n      if (position.slice(-1)[0] > 0) {\n        let sibling = parent.children.slice(position.slice(-1)[0]-1)[0];\n        let content = sibling.content;\n        setTimeout(() => {\n          placeCaretAtEnd($(`#${sibling.id}`).find(\".bullet-content\").get(0));\n          $(`#${sibling.id}`).find(\".bullet-content\").focus();\n        }, 0);\n      }\n      return state;\n    }\n  }\n}\n\nfunction indentBullet(position) {\n  return {\n    type: INDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (position.slice(-1)[0] == 0) { return state }\n      let childPosition = position.slice(-1)[0];\n      let tree = getTree(position.slice(0,-1), state.root);\n      let newParent = getNode([...position.slice(0,-1), (childPosition-1)], state.root);\n      let oldParent = tree.slice(-1)[0];\n      let child = oldParent.children.splice(childPosition,1)[0];\n      newParent.children.push(child);\n      tree.push(newParent);\n      setTimeout(() => {\n        tree.map(parent => {\n          $(`#${parent.id}`).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction unindentBullet(position) {\n  return {\n    type: UNINDENT_BULLET,\n    position,\n    exec: (state) => {\n      if (position.length < 3) { return state }\n      let childPosition = position.slice(-1)[0];\n      let oldParentPosition = position.slice(-2)[0];\n      let tree = getTree(position.slice(0, -2), state.root);\n      let newParent = tree.slice(-1)[0];\n      let oldParent = getNode(position.slice(0, -1), state.root);\n      let child = oldParent.children.splice(childPosition, 1)[0];\n      newParent.children.splice((oldParentPosition + 1), 0, child);\n      setTimeout(() => {\n        tree.slice(0,-2).map(parent => {\n          $(`#${parent.id}`).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction moveBullet(childPosition, newParentPosition) {\n  return {\n    type: MOVE_BULLET,\n    childPosition,\n    newParentPosition,\n    exec: (state) => {\n      console.log(childPosition, newParentPosition);\n      let newParent = getNode(newParentPosition.slice(), state.root);\n      let oldParent = getNode(childPosition.slice(0,-1), state.root);\n      let child = oldParent.children.splice(childPosition.slice(-1)[0], 1)[0];\n      newParent.children.push(child);\n      setTimeout(() => {\n        getTree(newParentPosition.slice(), state.root).map(parent => {\n          $(`#${parent.id}`).children(\".collapse\").addClass(\"show\");\n        });\n      }, 0);\n      return state;\n    }\n  }\n}\n\nfunction getNode(indices, root) {\n  let node = root[indices.shift()];\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n  }\n  return node;\n}\n\nfunction getTree(indices, root) {\n  let tree = [];\n  let node = root[indices.shift()];\n  tree.push(node)\n  while (indices.length > 0) {\n    node = node.children[indices.shift()];\n    tree.push(node);\n  }\n  return tree;\n}\n\nfunction placeCaretAtEnd(el) {\n  // https://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971\n  // @Tim Down\n  el.focus();\n  if (typeof window.getSelection != \"undefined\"\n          && typeof document.createRange != \"undefined\") {\n      var range = document.createRange();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      var sel = window.getSelection();\n      sel.removeAllRanges();\n      sel.addRange(range);\n  } else if (typeof document.body.createTextRange != \"undefined\") {\n      var textRange = document.body.createTextRange();\n      textRange.moveToElementText(el);\n      textRange.collapse(false);\n      textRange.select();\n  }\n}\n\n\n\nexport { ADD_BULLET,\n         EDIT_BULLET,\n         DELETE_BULLET,\n         INDENT_BULLET,\n         UNINDENT_BULLET,\n         MOVE_BULLET,\n         addBullet,\n         editBullet,\n         deleteBullet,\n         indentBullet,\n         unindentBullet,\n         moveBullet,\n         getNode,\n         getTree };\n"]},"metadata":{},"sourceType":"module"}